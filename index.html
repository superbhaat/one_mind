<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Meditation | One Mind</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        }
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- Main Application Container -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- App Header with Progress Indicator -->
        <div class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Create Your Meditation</h1>
            <div class="flex justify-center items-center space-x-1">
                <div class="h-2 w-16 rounded-full bg-primary-600"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
                <div class="h-2 w-16 rounded-full bg-gray-700"></div>
            </div>
            <p class="mt-2 text-gray-400">Step 1: Meditation Setup</p>
        </div>
        
        <!-- Step 1: User Meditation Setup Form -->
        <form id="meditationForm" class="space-y-12">
            <!-- Duration Selection Section -->
            <section class="bg-gray-800 rounded-xl p-6 shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">Select Meditation Length</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3" id="durationGrid">
                    <!-- Duration buttons will be generated by JavaScript -->
                </div>
            </section>
            
            <!-- Title Input Section -->
            <section class="bg-gray-800 rounded-xl p-6 shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">Meditation Title</h2>
                <div class="space-y-2">
                    <input type="text" id="meditationTitle" placeholder="Enter a title for your meditation" 
                        class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <p class="text-sm text-gray-400 italic">AI will suggest 3 alternative titles after creation</p>
                </div>
            </section>
            
            <!-- Theme Description Section -->
            <section class="bg-gray-800 rounded-xl p-6 shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">Meditation Theme</h2>
                <div class="space-y-2">
                    <div class="flex items-center space-x-2 mb-2">
                        <select id="themeSelector" class="bg-gray-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <option value="">Select a theme (optional)</option>
                            <option value="Stress Relief">Stress Relief</option>
                            <option value="Sleep">Sleep & Relaxation</option>
                            <option value="Focus">Focus & Concentration</option>
                            <option value="Anxiety">Anxiety Reduction</option>
                            <option value="Gratitude">Gratitude Practice</option>
                            <option value="Self-Love">Self-Love & Acceptance</option>
                            <option value="Mindfulness">Mindfulness & Presence</option>
                            <option value="Energy">Energy & Motivation</option>
                            <option value="Healing">Healing & Recovery</option>
                            <option value="Custom">Custom Theme...</option>
                        </select>
                    </div>
                    <textarea id="themeDescription" rows="4" placeholder="Describe the theme and focus of your meditation (e.g., stress relief, gratitude, sleep preparation...)" 
                        class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
                        maxlength="500"></textarea>
                    <div class="flex justify-end">
                        <span id="themeCounter" class="text-sm text-gray-400">0/500</span>
                    </div>
                </div>
            </section>
            
            <!-- Visual Theme Section -->
            <section class="bg-gray-800 rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-semibold">Visual Theme</h2>
                    <button type="button" id="generateVisualBtn" class="text-primary-400 hover:text-primary-300 transition-colors p-2 rounded-full hover:bg-gray-700" title="Generate with AI">
                        <i class="fas fa-wand-magic-sparkles text-xl"></i>
                    </button>
                </div>
                <div class="space-y-2">
                    <textarea id="visualTheme" rows="4" placeholder="Describe the visual atmosphere (colors, imagery, mood...)" 
                        class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
                        maxlength="500"></textarea>
                    <div class="flex justify-end">
                        <span id="visualCounter" class="text-sm text-gray-400">0/500</span>
                    </div>
                </div>
            </section>
            
            <!-- Navigation Buttons -->
            <div class="flex justify-center">
                <button type="button" id="generateTranscriptBtn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transition-colors transform hover:scale-105 active:scale-95">
                    Generate Transcript
                </button>
            </div>
        </form>
        
        <!-- Debug Output - Hidden in Production -->
        <div id="debugOutput" class="mt-8 p-4 bg-gray-800 rounded-lg hidden">
            <h3 class="text-xl font-semibold mb-2">Session Data (JSON):</h3>
            <pre id="jsonOutput" class="bg-gray-900 p-4 rounded overflow-x-auto text-xs"></pre>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Session state to store all meditation data
            const sessionState = {
                step: 1,
                meditation_title: '',
                theme: '',
                length_minutes: null,
                visual_theme_description: ''
            };
            
            // Generate duration buttons
            const durationGrid = document.getElementById('durationGrid');
            const durations = [5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60];
            
            durations.forEach(duration => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'duration-btn bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-full transition-colors';
                button.dataset.duration = duration;
                button.textContent = `${duration} min`;
                
                button.addEventListener('click', function() {
                    // Remove selected class from all buttons
                    document.querySelectorAll('.duration-btn').forEach(btn => {
                        btn.classList.remove('bg-primary-600');
                        btn.classList.add('bg-gray-700');
                    });
                    
                    // Add selected class to this button
                    this.classList.remove('bg-gray-700');
                    this.classList.add('bg-primary-600');
                    
                    // Update session state
                    sessionState.length_minutes = duration;
                    updateDebugOutput();
                });
                
                durationGrid.appendChild(button);
            });
            
            // Theme selector dropdown handling
            const themeSelector = document.getElementById('themeSelector');
            const themeDescription = document.getElementById('themeDescription');
            
            themeSelector.addEventListener('change', function() {
                if (this.value === 'Custom') {
                    // Clear the textarea for custom input
                    themeDescription.value = '';
                    themeDescription.focus();
                } else if (this.value !== '') {
                    // Set the textarea with the selected theme
                    themeDescription.value = this.value + ' meditation to ' + getThemeDescription(this.value);
                    updateCounter(themeDescription, themeCounter);
                    
                    // Update session state
                    sessionState.theme = this.value;
                    updateDebugOutput();
                }
            });
            
            // Helper to get theme descriptions
            function getThemeDescription(theme) {
                const descriptions = {
                    'Stress Relief': 'help calm the mind and release tension from the body',
                    'Sleep': 'prepare the mind and body for deep, restorative sleep',
                    'Focus': 'enhance concentration and mental clarity',
                    'Anxiety': 'reduce anxious thoughts and find inner calm',
                    'Gratitude': 'cultivate appreciation for life's blessings',
                    'Self-Love': 'foster self-compassion and inner kindness',
                    'Mindfulness': 'develop present moment awareness and acceptance',
                    'Energy': 'invigorate the mind and body with positive energy',
                    'Healing': 'support the body's natural healing processes'
                };
                
                return descriptions[theme] || '';
            }
            
            // Character counters for textareas
            const themeTextarea = document.getElementById('themeDescription');
            const visualTextarea = document.getElementById('visualTheme');
            const themeCounter = document.getElementById('themeCounter');
            const visualCounter = document.getElementById('visualCounter');
            
            function updateCounter(textarea, counter) {
                const currentLength = textarea.value.length;
                const maxLength = textarea.getAttribute('maxlength');
                counter.textContent = `${currentLength}/${maxLength}`;
            }
            
            // Input event listeners with session state updates
            themeTextarea.addEventListener('input', function() {
                updateCounter(themeTextarea, themeCounter);
                sessionState.theme = this.value;
                updateDebugOutput();
            });
            
            visualTextarea.addEventListener('input', function() {
                updateCounter(visualTextarea, visualCounter);
                sessionState.visual_theme_description = this.value;
                updateDebugOutput();
            });
            
            document.getElementById('meditationTitle').addEventListener('input', function() {
                sessionState.meditation_title = this.value;
                updateDebugOutput();
            });
            
            // Generate with AI button
            document.getElementById('generateVisualBtn').addEventListener('click', function() {
                const themeText = document.getElementById('themeDescription').value;
                
                if (!themeText.trim()) {
                    alert('Please describe your meditation theme first');
                    return;
                }
                
                // In a real app, this would call an AI API
                // For demo, just simulate with a timeout
                this.innerHTML = '<i class="fas fa-spinner fa-spin text-xl"></i>';
                this.disabled = true;
                
                setTimeout(() => {
                    const aiSuggestion = "A serene mountain landscape at dawn with soft purple and blue hues. The sky transitions from deep indigo to light lavender as the sun rises, creating a peaceful atmosphere. Gentle mist hovers over verdant valleys, while distant peaks are silhouetted against the brightening sky.";
                    document.getElementById('visualTheme').value = aiSuggestion;
                    updateCounter(visualTextarea, visualCounter);
                    
                    // Update session state
                    sessionState.visual_theme_description = aiSuggestion;
                    updateDebugOutput();
                    
                    this.innerHTML = '<i class="fas fa-wand-magic-sparkles text-xl"></i>';
                    this.disabled = false;
                }, 1500);
            });
            
            // Generate Transcript button - proceed to step 2
            document.getElementById('generateTranscriptBtn').addEventListener('click', function() {
                // Validate form
                let isValid = true;
                let errorMessage = '';
                
                // Check if duration is selected
                if (sessionState.length_minutes === null) {
                    isValid = false;
                    errorMessage += 'Please select a meditation duration. ';
                }
                
                // Check if title is entered
                if (!sessionState.meditation_title.trim()) {
                    isValid = false;
                    errorMessage += 'Please enter a meditation title. ';
                }
                
                // Check if theme is entered
                if (!sessionState.theme.trim()) {
                    isValid = false;
                    errorMessage += 'Please describe the meditation theme. ';
                }
                
                // Check if visual theme is entered
                if (!sessionState.visual_theme_description.trim()) {
                    isValid = false;
                    errorMessage += 'Please describe the visual theme. ';
                }
                
                if (isValid) {
                    // In a real app, this would proceed to step 2
                    alert('Proceeding to transcript generation...');
                    console.log('Step 1 completed. Session data:', sessionState);
                    
                    // Store data in localStorage for persistence
                    localStorage.setItem('meditationSession', JSON.stringify(sessionState));
                    
                    // In a full implementation, this would redirect to the next step
                    // window.location.href = 'transcript.html';
                } else {
                    // Show error
                    alert(errorMessage);
                }
            });
            
            // Debug helper to show JSON output
            function updateDebugOutput() {
                const jsonOutput = document.getElementById('jsonOutput');
                if (jsonOutput) {
                    jsonOutput.textContent = JSON.stringify(sessionState, null, 2);
                }
            }
            
            // Show debug output in development mode
            document.getElementById('debugOutput').classList.remove('hidden');
            updateDebugOutput();
            
            // Check for existing session data
            const savedSession = localStorage.getItem('meditationSession');
            if (savedSession) {
                try {
                    const data = JSON.parse(savedSession);
                    
                    // Restore form values
                    document.getElementById('meditationTitle').value = data.meditation_title || '';
                    document.getElementById('themeDescription').value = data.theme || '';
                    document.getElementById('visualTheme').value = data.visual_theme_description || '';
                    
                    // Restore duration selection
                    if (data.length_minutes) {
                        const durationBtn = document.querySelector(`.duration-btn[data-duration="${data.length_minutes}"]`);
                        if (durationBtn) {
                            durationBtn.click();
                        }
                    }
                    
                    // Update counters
                    updateCounter(themeTextarea, themeCounter);
                    updateCounter(visualTextarea, visualCounter);
                    
                    // Update session state
                    Object.assign(sessionState, data);
                    updateDebugOutput();
                } catch (e) {
                    console.error('Error restoring session:', e);
                }
            }
        });
    </script>
</body>
</html>